# Copyright 2025 the Kubeapps contributors.
# SPDX-License-Identifier: Apache-2.0

---
name: Build Custom Commit

on:
  workflow_dispatch:
    inputs:
      git_ref:
        description: 'Git commit SHA, branch, or tag to build'
        required: true
        type: string
      run_gke_tests:
        description: 'Run GKE tests (requires cloud setup)'
        required: false
        type: boolean
        default: false
      run_linters:
        description: 'Run linters'
        required: false
        type: boolean
        default: false
      trigger_release:
        description: 'Trigger release process'
        required: false
        type: boolean
        default: false

jobs:
  checkout_and_build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository at specified commit
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.git_ref }}
          fetch-depth: 0

      - name: Verify checkout
        run: |
          echo "Checked out commit: $(git rev-parse HEAD)"
          echo "Short SHA: $(git rev-parse --short HEAD)"
          echo "Branch/Tag: $(git describe --all --exact-match 2>/dev/null || echo 'detached HEAD')"
          git log -1 --oneline

  CI:
    needs: checkout_and_build
    uses: ./.github/workflows/kubeapps-general.yaml
    with:
      run_linters: ${{ inputs.run_linters }}
      trigger_release: ${{ inputs.trigger_release }}
    secrets: inherit

